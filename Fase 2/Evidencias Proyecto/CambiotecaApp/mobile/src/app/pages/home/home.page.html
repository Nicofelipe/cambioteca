<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>

    <ion-title>Cambioteca</ion-title>

    <ion-buttons slot="end">
      <ion-button (click)="buscar()">
        <ion-icon name="search-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="home-content" >
  <!-- Presentación / logo -->
  <section class="hero">
    <img src="assets/icon/cambiotecasimple.png" alt="Logo" loading="lazy" />
    <h2>Intercambia libros fácil y rápido</h2>
    <p>Descubre, intercambia y da una segunda vida a tus libros favoritos.</p>

    <ion-searchbar
      [(ngModel)]="q"
      placeholder="Buscar por título o autor"
      (ionInput)="buscar()"
      debounce="400"
    ></ion-searchbar>
  </section>

  <!-- Últimos agregados -->
  <section class="block">
  <div class="block-title">
    <h3>Últimos agregados</h3>
    <ion-spinner *ngIf="loading" name="dots"></ion-spinner>
  </div>

  <swiper-container
    slides-per-view="1.1"
    space-between="12"
    centered-slides="true"
    style="display:block"
    *ngIf="ultimos?.length; else noUltimos"
  >
    <swiper-slide *ngFor="let b of ultimos; trackBy: trackByLibro">
      <ion-card>
        <ion-card-header>
          <ion-card-title>{{ b.titulo }}</ion-card-title>
          <ion-card-subtitle>{{ b.autor }}</ion-card-subtitle>
        </ion-card-header>
        <ion-card-content>
          <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap">
            <ion-chip *ngIf="b.genero">{{ b.genero }}</ion-chip>
            <ion-chip *ngIf="b.owner_nombre" color="medium" outline="true">
              Subido por: {{ b.owner_nombre }}
            </ion-chip>
          </div>
          <div class="muted" style="margin-top:6px;">
            Publicado: {{ b.fecha_subida | date:'short' }}
          </div>
        </ion-card-content>
      </ion-card>
    </swiper-slide>
  </swiper-container>

  <ng-template #noUltimos>
    <ion-text color="medium">
      <p style="text-align: center;">No hay libros recientes aún.</p>
    </ion-text>
  </ng-template>
</section>

<!-- Populares -->
<section class="block">
  <div class="block-title">
    <h3>Populares</h3>
    <ion-spinner *ngIf="loadingPopulares" name="dots"></ion-spinner>
  </div>

  <swiper-container
    slides-per-view="1.1"
    space-between="12"
    centered-slides="true"
    style="display:block"
    *ngIf="populares?.length; else noPopulares"
  >
    <swiper-slide *ngFor="let p of populares; trackBy: trackByPopular">
      <ion-card>
        <ion-card-header>
          <ion-card-title>{{ p.titulo }}</ion-card-title>
          <ion-card-subtitle>Intercambios completados: {{ p.total_intercambios }}</ion-card-subtitle>
        </ion-card-header>
        <ion-card-content>
          <ion-chip color="medium" outline="true">
            Anuncios activos de este título: {{ p.repeticiones }}
          </ion-chip>
        </ion-card-content>
      </ion-card>
    </swiper-slide>
  </swiper-container>

  <ng-template #noPopulares>
    <ion-text color="medium">
      <p style="text-align: center;">No hay libros intercambiados aún.</p>
    </ion-text>
  </ng-template>
</section>
  <!-- Sobre nosotros -->
  <section class="block">
    <div class="block-title">
      <h3>Sobre nosotros</h3>
    </div>
    <p>
      Somos una comunidad que promueve la lectura circular. Únete, comparte y
      encuentra tu próxima lectura.
    </p>
  </section>

  <div style="height: 24px"></div>
</ion-content>
