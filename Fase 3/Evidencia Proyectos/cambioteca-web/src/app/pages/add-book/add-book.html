<div class="add-book-container">
  <h2>Añadir un Nuevo Libro al Catálogo</h2>
  <p class="subtitle">Completa los detalles de tu libro para que otros puedan encontrarlo.</p>

  <form [formGroup]="bookForm" (ngSubmit)="onSubmit()" class="book-form">
    
    <!-- 1. SECCIÓN ISBN (Buscador) -->
    <div class="form-group isbn-section">
      <label for="isbn">ISBN (13 dígitos) <small class="hint">- Úsalo para autocompletar</small></label>
      <div class="isbn-wrapper">
        <input type="text" id="isbn" formControlName="isbn" placeholder="Ej: 9780307474728">
        <button type="button" class="btn-search" (click)="searchIsbn()" [disabled]="isSearchingIsbn">
          <!-- Icono que gira si está buscando -->
          <i class="fa-solid" [ngClass]="isSearchingIsbn ? 'fa-spinner fa-spin' : 'fa-magic'"></i>
          {{ isSearchingIsbn ? 'Buscando...' : 'Autocompletar' }}
        </button>
      </div>
    </div>

    <!-- Fila 1 -->
    <div class="form-row">
      <div class="form-group">
        <label for="titulo">Título del Libro</label>
        <input type="text" id="titulo" formControlName="titulo">
      </div>
      <div class="form-group">
        <label for="autor">Autor</label>
        <input type="text" id="autor" formControlName="autor">
      </div>
    </div>

    <!-- Fila 2 -->
    <div class="form-row">
      <div class="form-group">
        <label for="editorial">Editorial</label>
        <input type="text" id="editorial" formControlName="editorial">
      </div>
      <div class="form-group">
        <label for="anio">Año de Publicación</label>
        <input type="number" id="anio" formControlName="anio_publicacion">
      </div>
    </div>

    <!-- Fila 3 -->
    <div class="form-row">
      <div class="form-group">
        <label for="genero">Género</label>
        <select id="genero" formControlName="id_genero">
          <option [ngValue]="null" disabled>Selecciona un género</option>
          <option *ngFor="let genero of generos" [value]="genero.id_genero">{{ genero.nombre }}</option>
        </select>
      </div>
      <div class="form-group">
        <label for="estado">Estado del Libro</label>
        <select id="estado" formControlName="estado">
          <option value="Nuevo">Nuevo</option>
          <option value="Como nuevo">Como nuevo</option>
          <option value="Buen estado">Buen estado</option>
          <option value="Con desgaste">Con desgaste</option>
        </select>
      </div>
    </div>

    <!-- Fila 4 -->
    <div class="form-row">
      <div class="form-group full-width-mobile">
        <label for="tapa">Tipo de Tapa</label>
        <select id="tapa" formControlName="tipo_tapa">
          <option value="Tapa blanda">Tapa blanda</option>
          <option value="Tapa dura">Tapa dura</option>
        </select>
      </div>
    </div>

    <!-- Fila 5 -->
    <div class="form-group full-width">
      <label for="descripcion">Descripción</label>
      <textarea id="descripcion" formControlName="descripcion" rows="4" placeholder="Detalles sobre el contenido o el estado físico..."></textarea>
    </div>

    <!-- Imágenes -->
    <div class="form-group full-width">
      <label for="imagenes">Imágenes del Libro</label>
      <input type="file" id="imagenes" accept="image/*" multiple (change)="onFilesSelected($event)" class="file-input">
      <small>Selecciona una imagen para marcarla como portada.</small>
    </div>

    <div *ngIf="previews.length > 0" class="image-previews-container">
      <div *ngFor="let preview of previews; let i = index" 
           class="preview-item" 
           (click)="setAsCover(i)"
           [class.is-cover]="i === coverIndex">
        <img [src]="preview" alt="Previsualización">
        <div class="cover-badge">{{ i === coverIndex ? 'Portada' : 'Elegir' }}</div>
      </div>
    </div>

    <!-- Botón de Envío (Sin mensajes antiguos) -->
    <div class="form-footer">
      <button type="submit" [disabled]="bookForm.invalid || isLoading" class="btn-submit">
        {{ isLoading ? 'Añadiendo...' : 'Añadir Libro' }}
      </button>
    </div>
  </form>
</div>

<!-- 2. COMPONENTE DE NOTIFICACIÓN (FLOTANTE) -->
<app-notification
  *ngIf="notificationMessage"
  [message]="notificationMessage"
  [type]="notificationType"
  (close)="clearNotification()">
</app-notification>